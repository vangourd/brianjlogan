<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Brian J Logan's Blog (Posts about general)</title><link>https://brianjlogan.com/</link><description></description><atom:link href="https://brianjlogan.com/categories/cat_general.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents © 2019 &lt;a href="mailto:id@brianjlogan.com"&gt;Brian Logan&lt;/a&gt; </copyright><lastBuildDate>Fri, 25 Oct 2019 20:23:22 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Introduction of my new blog</title><link>https://brianjlogan.com/posts/hello-world/</link><dc:creator>Brian Logan</dc:creator><description>&lt;div&gt;&lt;p&gt;Many significant contributions to society are simply unidentified as such until far after the origin author or creator can realize what they've done. The likelihood, that the work I create or the content I publish on this blog will surmount to much more than a helpful collection of articles for a few individuals, is slim. However I enjoy the creative process of writing and documenting the things that interest me. &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Therefore welcome to my blog dear stranger&lt;/strong&gt;. I hope you enjoy the curated contents within. &lt;/p&gt;&lt;/div&gt;</description><guid>https://brianjlogan.com/posts/hello-world/</guid><pubDate>Sat, 13 Jul 2019 18:03:00 GMT</pubDate></item><item><title>About Brian Logan</title><link>https://brianjlogan.com/posts/about/</link><dc:creator>Brian Logan</dc:creator><description>&lt;div&gt;&lt;h2&gt;About Brian Logan&lt;/h2&gt;
&lt;p&gt;Just some basic info about myself. Typical biography.&lt;/p&gt;
&lt;p&gt;Hey thanks for being interested in me. I'll provide some basic info for you but if there's something else you would like to know feel free to reach out to me.&lt;/p&gt;
&lt;h3&gt;Employment&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;1yr+ for Sanford Airport Authority as I.T. Coordinator&lt;/li&gt;
&lt;li&gt;~1.5 yr for VirTech Systems LLC as Jr. Systems Administrator&lt;/li&gt;
&lt;li&gt;3 months for PowerOne in Tech Sales&lt;/li&gt;
&lt;li&gt;2 yr Private Tech Consulting for Small Businesses in Lake County, FL&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;</description><guid>https://brianjlogan.com/posts/about/</guid><pubDate>Fri, 13 Jul 2018 15:03:12 GMT</pubDate></item><item><title>Resolvconf on two interfaces with discrete networks</title><link>https://brianjlogan.com/posts/resolvconf-two-interfaces/</link><dc:creator>Brian Logan</dc:creator><description>&lt;figure&gt;&lt;img src="https://brianjlogan.com/images/resolvconf.jpg"&gt;&lt;/figure&gt; &lt;div&gt;&lt;p&gt;Resolvconf on two interfaces with discrete networks
Getting resolvconf to resolve dns entries on two interfaces with discrete networks and dns servers.&lt;/p&gt;
&lt;p&gt;Why you would want this: - see at the end my notes on why you don't want to do this as well.&lt;/p&gt;
&lt;p&gt;You have two discrete networks that can't be joined and can't share DNS information across their network boundaries.
You have been somehow allowed to join two interfaces to a server connecting to each of these networks.
What you might expect
You would be tempted to think you can use your usual utilities for this. In my case I specifically rely on /etc/network/interfaces on my Ubuntu machines. It is old and reliable for me as systemd-network gets it act together.&lt;/p&gt;
&lt;p&gt;You might configure your /etc/network/interfaces files to look like this&lt;/p&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;eth0&lt;/span&gt; &lt;span class="n"&gt;eth1&lt;/span&gt;

&lt;span class="n"&gt;iface&lt;/span&gt; &lt;span class="n"&gt;eth0&lt;/span&gt; &lt;span class="n"&gt;inet&lt;/span&gt; &lt;span class="k"&gt;static&lt;/span&gt; 
    &lt;span class="n"&gt;address&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt; 
    &lt;span class="n"&gt;gateway&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt; 
    &lt;span class="n"&gt;network&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; 
    &lt;span class="n"&gt;netmask&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; 
    &lt;span class="n"&gt;dns&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;nameservers&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt; 
    &lt;span class="n"&gt;dns&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;search&lt;/span&gt; &lt;span class="n"&gt;sub&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;contoso&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;

&lt;span class="n"&gt;iface&lt;/span&gt; &lt;span class="n"&gt;eth1&lt;/span&gt; &lt;span class="n"&gt;inet&lt;/span&gt; &lt;span class="k"&gt;static&lt;/span&gt; 
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;same&lt;/span&gt; &lt;span class="n"&gt;entries&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;above&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;different&lt;/span&gt; &lt;span class="n"&gt;subnet&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; 
    &lt;span class="n"&gt;dns&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;nameservers&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt; 
    &lt;span class="n"&gt;dns&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;search&lt;/span&gt; &lt;span class="n"&gt;otherdomain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;net&lt;/span&gt;
&lt;/pre&gt;


&lt;p&gt;If I have these dns entries in both interfaces on a reboot it will turn my /etc/resolv.conf into&lt;/p&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;nameserver&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; 
&lt;span class="n"&gt;nameserver&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt; 
&lt;span class="n"&gt;nameserver&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; 
&lt;span class="k"&gt;search&lt;/span&gt; &lt;span class="n"&gt;sub&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;contoso&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt; &lt;span class="n"&gt;otherdomain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;net&lt;/span&gt;
&lt;/pre&gt;


&lt;p&gt;Which results in not being able to resolve anything on sub.contoso.com but being able to resolve otherdomain.net.&lt;/p&gt;
&lt;p&gt;What the heck!!?&lt;/p&gt;
&lt;p&gt;Why wouldn't the nameserver correlate to the interface stanza I setup?&lt;/p&gt;
&lt;p&gt;Why it doesn't work
Default entry limit
I found here that you can only add up to 3 entries by default in resolv.conf.&lt;/p&gt;
&lt;p&gt;You can of course as usual in linux tinker deeper into the stack and increase this limit in &amp;gt; /usr/include/resolv.h with the lines.&lt;/p&gt;
&lt;p&gt;/&lt;em&gt;
&lt;/em&gt; Global defines and variables for resolver stub.
*/&lt;/p&gt;
&lt;h2&gt;define MAXNS                  3       /&lt;em&gt; max # name servers we'll track &lt;/em&gt;/&lt;/h2&gt;
&lt;p&gt;But we're just trying to query two networks so there's no reason to open another element to cause bugs/issues. Moving on…&lt;/p&gt;
&lt;p&gt;The process that /etc/network/interfaces appears to use is it rotates nameservers as it parses the config. The last dns-nameserver entries you have is what goes into resolv.conf. So when you are putting dns info in your interfaces file it's mostly a convenience to save you from writing to your resolv/conf and messing with resolvconf and its database. The order you place them in the interfaces file, the stanza, or even the corresponding dns-search means nothing.&lt;/p&gt;
&lt;p&gt;If you have 8 dns entries in your interfaces file it will be cut to the last 3 entries and your dns-search string concatenated into a very long search line in your resolv.conf.&lt;/p&gt;
&lt;p&gt;Timeout not Rotation
Default behavior for multiple nameservers is to only trigger the secondary server if there is a timeout in the request a.k.a the server is down or there are network problems.&lt;/p&gt;
&lt;p&gt;This is a failover mechanism which is what you want for most situations. Good idea. Definitely best practice, but doesn't accomplish our goal at the moment. What we need is for our resolver to try all of the configured servers for the entry we are looking for before giving up. So..&lt;/p&gt;
&lt;p&gt;Instead of trying more servers on TIMEOUT we try more servers on SERVFAIL.&lt;/p&gt;
&lt;p&gt;The fix.
Configure your interfaces file as normal but omit nameservers until they fit in your resolv.conf or adjust your nameserver limit as shown above. Realize though that for every additional nameserver you are adding more servers to rotate through before you can query your end-server.&lt;/p&gt;
&lt;p&gt;Modify the resolvconf database Open up /etc/resolvconf/resolv.conf.d/base and create the following&lt;/p&gt;
&lt;p&gt;options rotate
wq! and/or your editors save and close equivalent&lt;/p&gt;
&lt;p&gt;It works! Why you shouldn't do this
First of all you now have to specify by FQDN for every query so anything coded to just a hostname lookup is going to fail.
Secondly you're rotating through your dns-servers for these queries when really you should have 1 authoritative DNS server
Thirdly this type of customization makes your setup a snowflake and you shouldn't be engineering your network to be a snowflake (that's another blog post)
If your argument is 'but how else will I contact the devices?'&lt;/p&gt;
&lt;p&gt;In my opinion this is a cop out. Someone isn't doing networking. Your computer should be able to talk to what it needs from its primary interface. We have routers, switches, and firewalls for connecting users and applications. Subscribing a computer as a client on two different networks is unnecessary complexity that will confuse future admins.&lt;/p&gt;
&lt;p&gt;But perfection is the root of all procrastination so when you need to get nitty gritty don't let me stop you from doing what you have to do. You'll just find your answer elsewhere or heaven forbid write your own solution in node.js.&lt;/p&gt;
&lt;p&gt;Sources:
Russel Ballestrini | Set-Dns-Resolver-Options Note: His item on the rotate setting here didn't actually work for me but showed me a way of editing resolvconf easily that will stay when generated by resolvconf.&lt;/p&gt;
&lt;p&gt;Into the Void | resolv.conf options and discovery of ISP DNS Issue Note: I noticed the proper options setting for resolv.conf in here which worked for my server. Resolv.conf Manpage&lt;/p&gt;&lt;/div&gt;</description><guid>https://brianjlogan.com/posts/resolvconf-two-interfaces/</guid><pubDate>Fri, 23 Mar 2018 15:03:12 GMT</pubDate></item></channel></rss>